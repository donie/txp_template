# an7_comments v0.3
# Extends the standard comments_invite and comments_count
# Iaian7 - John Einselen
# http://iaian7.com/txp/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTI6ImFuN19jb21tZW50cyI7czo3OiJ2ZXJzaW9uIjtzOjM6
IjAuMyI7czo2OiJhdXRob3IiO3M6MjI6IklhaWFuNyAtIEpvaG4gRWluc2VsZW4iO3M6MTA6
ImF1dGhvcl91cmkiO3M6MjI6Imh0dHA6Ly9pYWlhbjcuY29tL3R4cC8iO3M6MTE6ImRlc2Ny
aXB0aW9uIjtzOjU1OiJFeHRlbmRzIHRoZSBzdGFuZGFyZCBjb21tZW50c19pbnZpdGUgYW5k
IGNvbW1lbnRzX2NvdW50IjtzOjQ6InR5cGUiO2k6MDtzOjQ6ImhlbHAiO3M6MzUzODoiCTxw
Pgo8c3Ryb25nPjxzcGFuIGNsYXNzPSJjYXBzIj5JTlRST0RVQ1RJT048L3NwYW4+ICYjODIx
MTsgPC9zdHJvbmc+PC9wPgoKCTxwPmFuN19jb21tZW50IHRhZ3MgYWxsb3cgeW91IHVzZSBt
b3JlIGN1c3RvbWl6YWJsZSBjb21tZW50IGNvdW50cyBhbmQgcG9wLXVwIGNvbW1lbnQgaW52
aXRhdGlvbiwgaW5jbHVkaW5nIGN1c3RvbSBjb21tZW50IGNvdW50IG1lc3NhZ2VzIGZvciAw
LCAxLCBvciBtb3JlIGNvbW1lbnRzLCBhbmQgYSA8c3Ryb25nPmdsb2JhbDwvc3Ryb25nPiBj
b21tZW50IGludml0YXRpb24gKG92ZXJyaWRpbmcgdGhlIGluZGl2aWR1YWwgYXJ0aWNsZSBj
b21tZW50IGludml0YXRpb24gdGV4dCwgc28geW91IGNhbiBlYXNpbHkgY2hhbmdlIHRoZSBp
bnZpdGF0aW9uIGZvciB0aGUgZW50aXJlIHNpdGUpLjwvcD4KCgk8cD48c3Ryb25nPjxzcGFu
IGNsYXNzPSJjYXBzIj5FWEFNUExFUzwvc3Bhbj4gJiM4MjExOyA8L3N0cm9uZz48L3A+CgoJ
PHA+PGNvZGU+JiM2MDt0eHA6YW43X2NvbW1lbnRzX2ludml0ZSBjb21tZW50PSYjMzQ7bGVh
dmUgYSBjb21tZW50PyAmIzM0OyBjb3VudDA9JiMzNDt0aGVyZSBhcmVuJiMzOTt0IGFueSB5
ZXQhJiMzNDsgY291bnQxPSYjMzQ7b25lIGNvbW1lbnQmIzM0OyBjb3VudDI9JiMzNDsjIGNv
bW1lbnRzIGFuZCBjb3VudGluZyYjMzQ7IC8mIzYyOzwvY29kZT48L3A+CgoJPHA+PGVtPihp
biBhbiBhcnRpY2xlIHdpdGggbm8gY29tbWVudHMpPC9lbT4gPGE+bGVhdmUgYSBjb21tZW50
PyA8L2E+dGhlcmUgYXJlbiYjODIxNzt0IGFueSB5ZXQhPC9wPgoKCTxwPjxjb2RlPiYjNjA7
dHhwOmFuN19jb21tZW50c19jb3VudCBjb3VudDA9JiMzNDsmIzM0OyBjb3VudDE9JiMzNDtv
bmUgY29tbWVudCYjMzQ7IGNvdW50Mj0mIzM0OyMgY29tbWVudHMgYW5kIGNvdW50aW5nJiMz
NDsgLyYjNjI7PC9jb2RlPjwvcD4KCgk8cD48ZW0+KGluIGFuIGFydGljbGUgd2l0aCAzIGNv
bW1lbnRzKTwvZW0+IDMgY29tbWVudHMgYW5kIGNvdW50aW5nPC9wPgoKCTxwPjxzdHJvbmc+
PHNwYW4gY2xhc3M9ImNhcHMiPlRBR1M8L3NwYW4+ICYjODIxMTsgPC9zdHJvbmc+PC9wPgoK
CTxwPjxjb2RlPiYjNjA7dHhwOmFuN19jb21tZW50c19pbnZpdGUmIzYyOzwvY29kZT48L3A+
CgoJPHA+T3V0cHV0cyBhIGxpbmsgdG8gdGhlIFRleHRwYXR0ZXJuIHBvcC11cCBzdWJtaXNz
aW9uIGZvcm0sIGFsb25nIHdpdGggdGhlIGNvbW1lbnQgY291bnQuICBFYWNoIG9mIHRoZSBm
b2xsb3dpbmcgc2V0dGluZ3MgY2FuIGJlIGRlZmluZWQgaW4gZWFjaCB1c2Ugb2YgdGhlIHRh
Zywgb3IgaW4gdGhlIHBsdWdpbiBjb2RlIGFzIGEgZ2xvYmFsIGRlZmF1bHQuPC9wPgoKCTxw
PlRoZSAjIHN5bWJvbCBpcyByZXBsYWNlZCB3aXRoIHRoZSBudW1iZXIgb2YgY29tbWVudHMu
PC9wPgoKCTxwPjxjb2RlPmNvbW1lbnQ9JiMzNDtsZWF2ZSBhIGNvbW1lbnQmIzM0OzwvY29k
ZT4gJiM4MjExOyBUZXh0IHVzZWQgYXMgdGhlIHN1Ym1pdCBjb21tZW50IGxpbms8YnIgLz4K
PGNvZGU+Y291bnQwPSYjMzQ7bm8gY29tbWVudHMgeWV0JiMzNDs8L2NvZGU+ICYjODIxMTsg
RGlzcGxheSBmb3Igd2hlbiB0aGVyZSBhcmUgbm8gY29tbWVudHM8YnIgLz4KPGNvZGU+Y291
bnQxPSYjMzQ7b25lIGNvbW1lbnQmIzM0OzwvY29kZT4gJiM4MjExOyBEaXNwbGF5IGZvciBv
bmUgY29tbWVudDxiciAvPgo8Y29kZT5jb3VudDI9JiMzNDsjIGNvbW1lbnRzJiMzNDs8L2Nv
ZGU+ICYjODIxMTsgRGlzcGxheSBmb3IgbW9yZSB0aGFuIG9uZSBjb21tZW50PGJyIC8+Cjxj
b2RlPndpZHRoPSYjMzQ7NTAwJiMzNDs8L2NvZGU+ICYjODIxMTsgV2lkdGggb2YgdGhlIHBv
cHVwIHdpbmRvdywgaW4gcGl4ZWxzPGJyIC8+Cjxjb2RlPmhlaWdodD0mIzM0OzUwMCYjMzQ7
PC9jb2RlPiAmIzgyMTE7IEhlaWdodCBvZiB0aGUgcG9wdXAgd2luZG93LCBpbiBwaXhlbHM8
YnIgLz4KPGNvZGU+c2hvd2NvdW50PSYjMzQ7dHJ1ZSYjMzQ7PC9jb2RlPiAmIzgyMTE7IFNo
b3cgY29tbWVudCBjb3VudCwgdHJ1ZSAvIGZhbHNlPGJyIC8+Cjxjb2RlPmNsYXNzPSYjMzQ7
YW43X2NvbW1lbnRfaW52aXRlJiMzNDs8L2NvZGU+ICYjODIxMTsgPHNwYW4gY2xhc3M9ImNh
cHMiPkNTUzwvc3Bhbj4gY2xhc3MgYXBwbGllZCB0byB0aGUgbGluazxiciAvPgo8Y29kZT53
cmFwdGFnPSYjMzQ7bm9uZSYjMzQ7PC9jb2RlPiAmIzgyMTE7IDxzcGFuIGNsYXNzPSJjYXBz
Ij5IVE1MPC9zcGFuPiB0YWcgKHdpdGhvdXQgYnJhY2tldHMpLCAmIzgyMjA7bm9uZSYjODIy
MTsgc2V0cyBubyB0YWc8YnIgLz4KPGNvZGU+d3JhcGNsYXNzPSYjMzQ7JiMzNDs8L2NvZGU+
ICYjODIxMTsgPHNwYW4gY2xhc3M9ImNhcHMiPkNTUzwvc3Bhbj4gY2xhc3MgYXBwbGllZCB0
byB0aGUgd3JhcCB0YWcgKGlmIGFwcGxpY2FibGUpPC9wPgoKCTxwPjxjb2RlPiYjNjA7dHhw
OmFuN19jb21tZW50c19jb3VudCYjNjI7PC9jb2RlPjwvcD4KCgk8cD5PdXRwdXRzIG9ubHkg
dGhlIGNvbW1lbnQgY291bnQsIGFsbG93aW5nIHlvdSB0byB1c2UgVGV4dHBhdHRlcm4mIzgy
MTc7cyBvd24gY29tbWVudCBpbnZpdGF0aW9uIGxpbmtzLCBidXQgcmV0YWluIGFuN19jb21t
ZW50JiM4MjE3O3MgbW9yZSBjdXN0b21pemFibGUgY29tbWVudCBjb3VudCBkaXNwbGF5Ljwv
cD4KCgk8cD5UaGUgIyBzeW1ib2wgaXMgcmVwbGFjZWQgd2l0aCB0aGUgbnVtYmVyIG9mIGNv
bW1lbnRzLjwvcD4KCgk8cD48Y29kZT5jb3VudDA9JiMzNDtubyBjb21tZW50cyB5ZXQmIzM0
OzwvY29kZT4gJiM4MjExOyBEaXNwbGF5IGZvciB3aGVuIHRoZXJlIGFyZSBubyBjb21tZW50
czxiciAvPgo8Y29kZT5jb3VudDE9JiMzNDtvbmUgY29tbWVudCYjMzQ7PC9jb2RlPiAmIzgy
MTE7IERpc3BsYXkgZm9yIG9uZSBjb21tZW50PGJyIC8+Cjxjb2RlPmNvdW50Mj0mIzM0OyMg
Y29tbWVudHMmIzM0OzwvY29kZT4gJiM4MjExOyBEaXNwbGF5IGZvciBtb3JlIHRoYW4gb25l
IGNvbW1lbnQ8YnIgLz4KPGNvZGU+d3JhcHRhZz0mIzM0O25vbmUmIzM0OzwvY29kZT4gJiM4
MjExOyA8c3BhbiBjbGFzcz0iY2FwcyI+SFRNTDwvc3Bhbj4gdGFnICh3aXRob3V0IGJyYWNr
ZXRzKSwgJiM4MjIwO25vbmUmIzgyMjE7IHNldHMgbm8gdGFnPGJyIC8+Cjxjb2RlPndyYXBj
bGFzcz0mIzM0OyYjMzQ7PC9jb2RlPiAmIzgyMTE7IDxzcGFuIGNsYXNzPSJjYXBzIj5DU1M8
L3NwYW4+IGNsYXNzIGFwcGxpZWQgdG8gdGhlIHdyYXAgdGFnIChpZiBhcHBsaWNhYmxlKTwv
cD4KCgk8cD48c3Ryb25nPjxzcGFuIGNsYXNzPSJjYXBzIj5DUkVESVRTPC9zcGFuPiAmIzgy
MTE7IDwvc3Ryb25nPjwvcD4KCgk8cD5UaGUgdHV0b3JpYWxzIGZyb20gPGEgaHJlZj0iaHR0
cDovL3RocmVzaG9sZHN0YXRlLmNvbS9hcnRpY2xlcy8zOTc1L2FuYXRvbXktb2YtYS10ZXh0
cGF0dGVybi1wbHVnaW4tcGFydC0xIj50aHJlc2hvbGRzdGF0ZS5jb208L2E+IHR1dG9yaWFs
cyB3ZXJlIGhlbHBmdWwgYXMgYWx3YXlzLCBhcyB3YXMgPGEgaHJlZj0iaHR0cDovL3d3dy5w
aHAubmV0LyI+cGhwLm5ldDwvYT4uPC9wPiI7czo0OiJjb2RlIjtzOjI5NjI6IgpmdW5jdGlv
biBhbjdfY29tbWVudHNfaW52aXRlKCRhdHRzKSAgewoJZ2xvYmFsICRwcmVmczsKCWdsb2Jh
bCAkdGhpc2FydGljbGU7CmV4dHJhY3QobEF0dHMoYXJyYXkoCgkvLyBUSEUgRk9MTE9XSU5H
IEFSRSBUSEUgREVGQVVMVCBQUkVGRVJFTkNFUyBmb3IgQU43X0NPTU1FTlRTX0lOVklURQoJ
Ly8gVGhlICMgc3ltYm9sIGlzIHJlcGxhY2VkIHdpdGggdGhlIG51bWJlciBvZiBjb21tZW50
cy4KCSdjb21tZW50JyA9PiAnbGVhdmUgYSBjb21tZW50JywJLy8gVGV4dCB1c2VkIGFzIHRo
ZSBzdWJtaXQgY29tbWVudCBsaW5rCgknY291bnQwJyA9PiAnIChubyBjb21tZW50cyB5ZXQp
JywvLyBEaXNwbGF5IGZvciB3aGVuIHRoZXJlIGFyZSBubyBjb21tZW50cwoJJ2NvdW50MScg
PT4gJyAoIyBjb21tZW50KScsCQkvLyBEaXNwbGF5IGZvciBvbmUgY29tbWVudAoJJ2NvdW50
MicgPT4gJyAoIyBjb21tZW50cyknLAkvLyBEaXNwbGF5IGZvciBtb3JlIHRoYW4gb25lIGNv
bW1lbnQKCSd3aWR0aCcgPT4gJzQ4MCcsCQkJCS8vIFdpZHRoIG9mIHRoZSBwb3B1cCB3aW5k
b3csIGluIHBpeGVscwoJJ2hlaWdodCcgPT4gJzQ4MCcsCQkJCS8vIEhlaWdodCBvZiB0aGUg
cG9wdXAgd2luZG93LCBpbiBwaXhlbHMKCSdzaG93Y291bnQnID0+ICd0cnVlJywJCQkvLyBT
aG93IHRoZSBjb3VudCBvciBub3QsIHRydWUgLyBmYWxzZQoJJ2NsYXNzJyA9PiAnY29tbWVu
dHNfaW52aXRlJywJLy8gQ1NTIGNsYXNzIGFwcGxpZWQgdG8gdGhlIGxpbmsKCSd3cmFwdGFn
JyA9PiAnbm9uZScsCQkJLy8gSFRNTCB0YWcgKHdpdGhvdXQgYnJhY2tldHMpLCAibm9uZSIg
c2V0cyBubyB0YWcKCSd3cmFwY2xhc3MnID0+ICdub25lJywJCQkvLyBDU1MgY2xhc3MgYXBw
bGllZCB0byB0aGUgd3JhcCB0YWcgKGlmIGFwcGxpY2FibGUpCgkvLyBFTkQgT0YgREVGQVVM
VCBQUkVGRVJFTkNFUyBmb3IgQU43X0NPTU1FTlRTX0lOVklURQopLCRhdHRzKSk7CiR1cmwg
PSAkcHJlZnNbJ3NpdGV1cmwnXTsKJGlkID0gJHRoaXNhcnRpY2xlWyd0aGlzaWQnXTsKJG51
bWJlciA9ICR0aGlzYXJ0aWNsZVsnY29tbWVudHNfY291bnQnXTsKCmlmICgkc2hvd2NvdW50
KSB7CglpZiAoJG51bWJlciA+IDEpIHsKCQkkY291bnRlZCA9IHN0cl9yZXBsYWNlKCIjIiwg
JG51bWJlciwgJGNvdW50Mik7Cgl9IGVsc2UgaWYgKCRudW1iZXIgPT0gMSkgewoJCSRjb3Vu
dGVkID0gc3RyX3JlcGxhY2UoIiMiLCAkbnVtYmVyLCAkY291bnQxKTsKCX0gZWxzZSB7CgkJ
JGNvdW50ZWQgPSBzdHJfcmVwbGFjZSgiIyIsICRudW1iZXIsICRjb3VudDApOwoJfQoJJGRp
c3BsYXkgPSAkY291bnRlZDsKfSBlbHNlIHsKCSRkaXNwbGF5ID0gJyc7Cn0KCmlmICgkd3Jh
cHRhZyA9PSAnbm9uZScpIHsKCSR3cmFwb3BlbiA9ICcnOwoJJHdyYXBjbG9zZSA9ICcnOwp9
IGVsc2UgewoJJHdyYXBvcGVuID0gJzwnLiR3cmFwdGFnLic+JzsKCSR3cmFwY2xvc2UgPSAn
PC8nLiR3cmFwdGFnLic+JzsKfQoKaWYgKCR3cmFwY2xhc3MgIT09ICdub25lJykgewoJJHdy
YXBvcGVuID0gJzwnLiR3cmFwdGFnLicgY2xhc3M9IicuJHdyYXBjbGFzcy4nIj4nOwp9Cgpy
ZXR1cm4gJHdyYXBvcGVuLic8YSBocmVmPSJodHRwOi8vJy4kdXJsLicvP3BhcmVudGlkPScu
JGlkLiciIG9uY2xpY2s9IndpbmRvdy5vcGVuKHRoaXMuaHJlZiwgXCdwb3B1cHdpbmRvd1wn
LCBcJ3dpZHRoPScuJHdpZHRoLicsaGVpZ2h0PScuJGhlaWdodC4nLHNjcm9sbGJhcnMscmVz
aXphYmxlLHN0YXR1c1wnKTsgcmV0dXJuIGZhbHNlOyIgY2xhc3M9IicuJGNsYXNzLiciPicu
JGNvbW1lbnQuJzwvYT4nLiRkaXNwbGF5LiR3cmFwY2xvc2U7Cgp9CgpmdW5jdGlvbiBhbjdf
Y29tbWVudHNfY291bnQoJGF0dHMpICB7CglnbG9iYWwgJHRoaXNhcnRpY2xlOwpleHRyYWN0
KGxBdHRzKGFycmF5KAoJLy8gVEhFIEZPTExPV0lORyBBUkUgVEhFIERFRkFVTFQgUFJFRkVS
RU5DRVMgZm9yIEFON19DT01NRU5UU19DT1VOVAoJLy8gVGhlICMgc3ltYm9sIGlzIHJlcGxh
Y2VkIHdpdGggdGhlIG51bWJlciBvZiBjb21tZW50cy4KCSdjb3VudDAnID0+ICcgKG5vIGNv
bW1lbnRzIHlldCknLC8vIERpc3BsYXkgZm9yIHdoZW4gdGhlcmUgYXJlIG5vIGNvbW1lbnRz
CgknY291bnQxJyA9PiAnICgjIGNvbW1lbnQpJywJCS8vIERpc3BsYXkgZm9yIG9uZSBjb21t
ZW50CgknY291bnQyJyA9PiAnICgjIGNvbW1lbnRzKScsCS8vIERpc3BsYXkgZm9yIG1vcmUg
dGhhbiBvbmUgY29tbWVudAoJJ3dyYXB0YWcnID0+ICdub25lJywJCQkvLyBIVE1MIHRhZyAo
d2l0aG91dCBicmFja2V0cykKCSd3cmFwY2xhc3MnID0+ICdub25lJywJCQkvLyBDU1MgY2xh
c3MgYXBwbGllZCB0byB0aGUgd3JhcCB0YWcgKGlmIGFwcGxpY2FibGUpCgkvLyBFTkQgT0Yg
REVGQVVMVCBQUkVGRVJFTkNFUyBmb3IgQU43X0NPTU1FTlRTX0NPVU5UCiksJGF0dHMpKTsK
JGRpc3BsYXkgPSAnJzsKJG51bWJlciA9ICR0aGlzYXJ0aWNsZVsnY29tbWVudHNfY291bnQn
XTsKCmlmICgkbnVtYmVyID4gMSkgewoJJGRpc3BsYXkgPSBzdHJfcmVwbGFjZSgiIyIsICRu
dW1iZXIsICRjb3VudDIpOwp9IGVsc2UgaWYgKCRudW1iZXIgPT0gMSkgewoJJGRpc3BsYXkg
PSBzdHJfcmVwbGFjZSgiIyIsICRudW1iZXIsICRjb3VudDEpOwp9IGVsc2UgewoJJGRpc3Bs
YXkgPSBzdHJfcmVwbGFjZSgiIyIsICRudW1iZXIsICRjb3VudDApOwp9CgppZiAoJHdyYXB0
YWcgPT0gJ25vbmUnKSB7Cgkkd3JhcG9wZW4gPSAnJzsKCSR3cmFwY2xvc2UgPSAnJzsKfSBl
bHNlIHsKCSR3cmFwb3BlbiA9ICc8Jy4kd3JhcHRhZy4nPic7Cgkkd3JhcGNsb3NlID0gJzwv
Jy4kd3JhcHRhZy4nPic7Cn0KCmlmICgkd3JhcGNsYXNzICE9PSAnbm9uZScpIHsKCSR3cmFw
b3BlbiA9ICc8Jy4kd3JhcHRhZy4nIGNsYXNzPSInLiR3cmFwY2xhc3MuJyI+JzsKfQoKcmV0
dXJuICR3cmFwb3Blbi4kZGlzcGxheS4kd3JhcGNsb3NlOwoKfQoiO3M6MzoibWQ1IjtzOjMy
OiI1NGVmYzY2YTFlMTllOTIxM2FlZjQ4OGM4OGU0NTI2MiI7fQ==
